
<!-- Include Required Prerequisites -->
<script type="text/javascript" src="//cdn.jsdelivr.net/jquery/1/jquery.min.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap/3/css/bootstrap.css" />
 
<!-- Include Date Range Picker -->
<script type="text/javascript" src="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.js"></script>
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.css" />

<div class="main">
<div class="graph">


<div class="timeline">

</div>


<div class="graph">
<p><%= select_tag "typ", "<option value='today'>Today</option><option value='week'>This Week</option><option value='month'>This Month</option>".html_safe, include_blank: true %></p>
<p><%= select_tag "typ1", "<option value='yesterday'>Yesterday</option><option value='pastweek'>Previous Week</option><option value='pastmonth'>Previous Month</option>".html_safe, include_blank: true %></p>
<p>

<input type="text" name="daterange" value="01/01/2015 - 01/31/2015" /></p>

</div>


<% if params[:start]!=nil  && params[:end]!=nil%>
  <%= area_chart @performance.group(:created_at).where('created_at >=?',params[:start].to_datetime).where('created_at <=?',params[:end].to_datetime+1.day).sum(:responsetime), xtitle: "Created at", ytitle: "Response Time(ms)",title: 'Daily Performances',
    colors: ['green'], library: {chart: {zoomType: 'x'}}%> 
<%end%>



<%if params[:typ]!="week" && params[:typ]!="today" && params[:typ]!="month" && params[:typ]!="stop" && params[:typ1]!="yesterday" && params[:typ1]!="pastweek" && params[:typ1]!="pastmonth" && params[:start]==nil && params[:end]==nil%>

  <%= area_chart @performance.group(:created_at).where('created_at >=?',DateTime.now.beginning_of_day).sum(:responsetime), xtitle: "Created at", ytitle: "Response Time",title: 'Daily Performances',colors: ['green'], library: {chart: {zoomType: 'x'} }%> 
<%end%>

<% if params[:typ]=="week" %>
 <%= area_chart @performance.group_by_day(:created_at,last: 7).average(:responsetime) , xtitle: "Created at", ytitle: "Response Time(ms)",
 title: 'Weekly Performances',
    colors: ['blue'], library: {chart: {zoomType: 'x'}}%>
<%end%>

<% if params[:typ]=="month" %>
 <%= area_chart @performance.group_by_week(:created_at, last: 4, time_zone: "Kuala Lumpur").average(:responsetime), xtitle: "Created at", ytitle: "Response Time(ms)",
 title: 'Monthly Performances',
    colors: ['red'], library: {chart: {zoomType: 'x'} } %>
<%end%>

<% if params[:typ]=="today" %>
 <%= area_chart @performance.group(:created_at).where('created_at >=?',DateTime.now.beginning_of_day).sum(:responsetime), xtitle: "Created at", ytitle: "Response Time(ms)",title: 'Daily Performances', 
    colors: ['green'], library: {chart: {zoomType: 'x'}}%> 
<%end%>

<% if params[:typ1]=="yesterday" %>
 <%= area_chart @performance.group(:created_at).where('created_at >=?',DateTime.yesterday.beginning_of_day).where('created_at <=?',DateTime.now.beginning_of_day).sum(:responsetime), xtitle: "Created at", ytitle: "Response Time(ms)",title: 'Daily Performances',
    colors: ['green'], library: {chart: {zoomType: 'x'}}%> 
 <%end%>

<% if params[:typ1]=="pastweek" %>
<%= area_chart @performance.group_by_day(:created_at,last: 7).where('created_at <=?',7.day.ago).average(:responsetime) , xtitle: "Created at", ytitle: "Response Time(ms)",
 title: 'Weekly Performances',
    colors: ['blue'], library: {chart: {zoomType: 'x'} }%>
<%end%>

<% if params[:typ1]=="pastmonth" %>
<%= area_chart @performance.group_by_week(:created_at, last: 4, time_zone: "Kuala Lumpur").where('created_at <=?',30.day.ago).average(:responsetime), xtitle: "Created at", ytitle: "Response Time(ms)",
 title: 'Monthly Performances',
    colors: ['red'], library: {chart: {zoomType: 'x'} } %>
<%end%>
</div>     



<p id="notice"><%= notice %></p>
<% if @average==" " %>

<p><strong><span>Average : </span></strong>-</p> 
<p><strong><span>Highest  :</span></strong>-</p> 
<p><strong><span>Lowest :</span></strong>-</p>
<hr>
<p><strong><span>Total Query :</span></strong>-</p>
<p><strong><span>Total Fail :</span></strong>-</p>
<p><strong><span>Availability Status :</span>-</strong></p>
<%else%>
<% if params[:typ]!="today" && params[:typ]!="week"  && params[:typ]!="month" %>
<p><strong><span>Average : </span></strong><%= @average %>&nbsp;msec</p> 
<p><strong><span>Highest  :</span></strong><%= @highest %>&nbsp;msec</p> 
<p><strong><span>Lowest :</span></strong><%= @lowest %>&nbsp;msec</p>
<hr>
<p><strong><span>Total Query :</span></strong><%= @count %></p>
<p><strong><span>Total Fail :</span></strong><%= @unavailable %></p>
<p><strong><span>Availability Status :</span></strong><%= @availability %>%</p>
<%end%>
<% if params[:typ]=="today" %>
<p><strong><span>Average : </span></strong><%= @average %>&nbsp;msec</p> 
<p><strong><span>Highest  :</span></strong><%= @highest %>&nbsp;msec</p> 
<p><strong><span>Lowest :</span></strong><%= @lowest %>&nbsp;msec</p>
<hr>
<p><strong><span>Total Query :</span></strong><%= @count %></p>
<p><strong><span>Total Fail :</span></strong><%= @unavailable %></p>
<p><strong><span>Availability Status :</span></strong><%= @availability %>%</p>
<%end%>
<% if params[:typ]=="week" %>
<%= a=@performance.group_by_day(:created_at, last: 7).average(:responsetime).max %>
<% b=@performance.group_by_day(:created_at, last: 7).average(:responsetime).min %>
<p><strong><span>Average : </span></strong><%= @average %>&nbsp;msec</p> 
<p><strong><span>Highest  :</span></strong><%= a[1] %>&nbsp;msec</p> 
<p><strong><span>Lowest :</span></strong><%= b[1] %>&nbsp;msec</p>
<hr>
<p><strong><span>Total Query :</span></strong><%= @count %></p>
<p><strong><span>Total Fail :</span></strong><%= @unavailable %></p>
<p><strong><span>Availability Status :</span></strong><%= @availability %>%</p>
<%end%>
<% if params[:typ]=="month" %>
<%  a=@performance.group_by_week(:created_at, last: 4).average(:responsetime).max%>
<%  b=@performance.group_by_week(:created_at, last: 4).average(:responsetime).min %>
<p><strong><span>Average : </span></strong><%= @average%>&nbsp;msec</p> 
<p><strong><span>Highest  :</span></strong><%= a[1]  %>&nbsp;msec</p> 
<p><strong><span>Lowest :</span></strong><%= b[1] %>&nbsp;msec</p>
<hr>
<p><strong><span>Total Query :</span></strong><%= @count %></p>
<p><strong><span>Total Fail :</span></strong><%= @unavailable %></p>
<p><strong><span>Availability Status :</span></strong><%= @availability %>%</p>
<%end%>
<%end%>


<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<% if params[:typ]!="month" && params[:typ]!="week" %>
<div id="container0" style="min-width: 310px; height: 400px; max-width: 600px; margin: 0 auto"></div>
<%end%>

<% if params[:typ]=="week" %>
<div class=graph2>
<div id="container1" style="min-width: 200px; height: 200px; max-width: 600px; margin: 0 auto"></div>
<div id="container2" style="min-width: 200px; height: 200px; max-width: 600px; margin: 0 auto"></div>
<div id="container3" style="min-width: 200px; height: 200px; max-width: 600px; margin: 0 auto"></div>
<div id="container4" style="min-width: 200px; height: 200px; max-width: 600px; margin: 0 auto"></div>
<div id="container5" style="min-width: 200px; height: 200px; max-width: 600px; margin: 0 auto"></div>
<div id="container6" style="min-width: 200px; height: 200px; max-width: 600px; margin: 0 auto"></div>
<div id="container7" style="min-width: 200px; height: 200px; max-width: 600px; margin: 0 auto"></div>
</div>
<%end%>
<% if params[:typ]=="month" %>
<div class=graph3>
<div class="container8" style="min-width: 200px; height: 200px; max-width: 600px; margin: 0 auto"></div>
<div id="container9" style="min-width: 200px; height: 200px; max-width: 600px; margin: 0 auto"></div>
<div id="container10" style="min-width: 200px; height: 200px; max-width: 600px; margin: 0 auto"></div>
<div id="container11" style="min-width: 200px; height: 200px; max-width: 600px; margin: 0 auto"></div>
</div>
<%end%>



<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {

        var data = google.visualization.arrayToDataTable([
          ['Effort', 'Amount given'],
          ['My all',     100],
           ['My alls',     200],
        ]);

        var options = {
          pieHole: 0.5,
          pieSliceTextStyle: {
            color: 'black',
          },
          legend: 'none'
        };

        var chart = new google.visualization.PieChart(document.getElementById('donut_single'));
        chart.draw(data, options);
      }
    </script>




<head>
<style>

.graph p{
  display: inline-block;
}
.graph2 div{
  display: inline-block;
}
.graph3 div{
  display: inline-block;
}
hr {
  border:none;
  
  height: 50px;
  margin-top: 0;
  border-bottom: 1px solid #C0C0C0;
  box-shadow: 0 15px 15px -15px #C0C0C0;
  margin: -50px auto 10px; 
}

.main{
 margin-top: 70px;

}
</style>
</head>

<hr > 

<h1>Performances</h1>

<table>
  <thead>
    <tr>
      <th>No.&nbsp;</th>
      <th>Response Time(Milisecond)&nbsp;</th>
      <th>Date Time&nbsp;</th>

      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
  <tr>
    <td><% @total %></td>
  </tr>
   <% b=0%>
    <% @performances.each do |performance| %>
      <tr>
      
      <% if @question.id==performance.question_id %>
        <td><%= b=b+1 %>.</td>
        <td><%= performance.responsetime %>&nbsp;</td>
        <td><%= performance.created_at.localtime.strftime("%d/%m/%y ""%I:%M %p" )%>&nbsp;</td>
        <% a=performance.responsetime %>

        <script>
      

        </script>
       
        <%end%>
      </tr>
      <% @total %>
    <% end %>
  </tbody>
</table>

<br>
 
<%= will_paginate @performances %>
<%= link_to 'Back', questions_path %>
<script>

$('input[name="daterange"]').daterangepicker(
{
    locale: {
      format: 'YYYY-MM-DD'
    },
    startDate:'2017-07-01',
    endDate: '2017-8-31'

}, 
function(start, end, label) {
    alert("A new date range was chosen: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD') );
    window.location.href = "/questions/" + "<%= @question.id %>"+"/performances?start=" + start.format('YYYY-MM-DD') + "&end=" + end.format('YYYY-MM-DD')
});




$( "#typ" ).change(function() {
  
  Turbolinks.visit("?typ="+ this.value);
});

$( "#typ1" ).change(function() {
  
  Turbolinks.visit("?typ1="+ this.value);
});
Highcharts.chart('container0', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'DNS Availability'
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
            }
        }
    },
    series: [{
        name: 'Brands',
        colorByPoint: true,
        data: [{
            name: 'Success',
            y: <%= @availability%>
        }, {
            name: 'Fail',
            y: <%= @fail %>,
            sliced: true,
            selected: true
        }]
    }]
});

Highcharts.chart('container1', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'Day 1'
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
            }
        }
    },
    series: [{
        name: 'Brands',
        colorByPoint: true,
        data: [{
            name: 'Success',
            y: <%= @availability%>
        }, {
            name: 'Fail',
            y: <%= @fail %>,
            sliced: true,
            selected: true
        }]
    }]
});


///////////////////////////////////////////////////

  
  
  Highcharts.chart('container2', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'Day 2'
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
            }
        }
    },
    series: [{
        name: 'Brands',
        colorByPoint: true,
        data: [{
            name: 'Success',
            y: <%= @availability%>
        }, {
            name: 'Fail',
            y: <%= @fail %>,
            sliced: true,
            selected: true
        }]
    }]
});
  Highcharts.chart('container3', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'Day 3'
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
            }
        }
    },
    series: [{
        name: 'Brands',
        colorByPoint: true,
        data: [{
            name: 'Success',
            y: <%= @availability%>
        }, {
            name: 'Fail',
            y: <%= @fail %>,
            sliced: true,
            selected: true
        }]
    }]
});
  Highcharts.chart('container4', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'Day 4'
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
            }
        }
    },
    series: [{
        name: 'Brands',
        colorByPoint: true,
        data: [{
            name: 'Success',
            y: <%= @availability%>
        }, {
            name: 'Fail',
            y: <%= @fail %>,
            sliced: true,
            selected: true
        }]
    }]
});
  Highcharts.chart('container5', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'Day 5'
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
            }
        }
    },
    series: [{
        name: 'Brands',
        colorByPoint: true,
        data: [{
            name: 'Success',
            y: <%= @availability%>
        }, {
            name: 'Fail',
            y: <%= @fail %>,
            sliced: true,
            selected: true
        }]
    }]
});
  Highcharts.chart('container6', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'Day 6'
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
            }
        }
    },
    series: [{
        name: 'Brands',
        colorByPoint: true,
        data: [{
            name: 'Success',
            y: <%= @availability%>
        }, {
            name: 'Fail',
            y: <%= @fail %>,
            sliced: true,
            selected: true
        }]
    }]
});
  Highcharts.chart('container7', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'Day 7'
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
            }
        }
    },
    series: [{
        name: 'Brands',
        colorByPoint: true,
        data: [{
            name: 'Success',
            y: <%= @availability%>
        }, {
            name: 'Fail',
            y: <%= @fail %>,
            sliced: true,
            selected: true
        }]
    }]
});
  Highcharts.chart('container8', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'Week 1'
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
            }
        }
    },
    series: [{
        name: 'Brands',
        colorByPoint: true,
        data: [{
            name: 'Success',
            y: <%= @availability%>
        }, {
            name: 'Fail',
            y: <%= @fail %>,
            sliced: true,
            selected: true
        }]
    }]
});
    Highcharts.chart('container9', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'Week 2'
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
            }
        }
    },
    series: [{
        name: 'Brands',
        colorByPoint: true,
        data: [{
            name: 'Success',
            y: <%= @availability%>
        }, {
            name: 'Fail',
            y: <%= @fail %>,
            sliced: true,
            selected: true
        }]
    }]
});

      Highcharts.chart('container10', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'Week 3'
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
            }
        }
    },
    series: [{
        name: 'Brands',
        colorByPoint: true,
        data: [{
            name: 'Success',
            y: <%= @availability%>
        }, {
            name: 'Fail',
            y: <%= @fail %>,
            sliced: true,
            selected: true
        }]
    }]
});

        Highcharts.chart('container11', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'Week 4'
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
            }
        }
    },
    series: [{
        name: 'Brands',
        colorByPoint: true,
        data: [{
            name: 'Success',
            y: <%= @availability%>
        }, {
            name: 'Fail',
            y: <%= @fail %>,
            sliced: true,
            selected: true
        }]
    }]
});

</script>
<style>

</style>
